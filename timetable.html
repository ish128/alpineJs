<!DOCTYPE html>
<head>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        function getData(){
            return {
                keyList:{},
                currentSelectedSubject: null,
                dayOfWeekList: [{value:'1', text: '월'}, {value:'2', text: '화'}, {value:'3', text: '수'}, 
                            {value:'4', text: '목'}, {value:'5', text: '금'}],
                periodList: [{value:'1', text: '1교시'}, 
                            {value:'2', text: '2교시'}, 
                            {value:'3', text: '3교시'},
                            {value:'4', text: '4교시'}, 
                            {value:'5', text: '5교시'},
                            {value:'6', text: '6교시'}],
                userSchedule: {}, 
                userScheduleList: [ 
                                    {dayOfWeek:'1', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'2', periodNo: '1', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '2', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '3', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '4', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '5', subjectId: 2, subjectName: '영어'},

                                    {dayOfWeek:'3', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'4', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'5', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '5', subjectId: 1, subjectName: '수학'},
                                ],
                                userScheduleList2: [ 
                                    {dayOfWeek:'1', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'1', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'2', periodNo: '1', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '2', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '3', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '4', subjectId: 2, subjectName: '영어'},
                                    {dayOfWeek:'2', periodNo: '5', subjectId: 2, subjectName: '영어'},

                                    {dayOfWeek:'3', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'3', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'4', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'4', periodNo: '5', subjectId: 1, subjectName: '수학'},

                                    {dayOfWeek:'5', periodNo: '1', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '2', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '3', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '4', subjectId: 1, subjectName: '수학'},
                                    {dayOfWeek:'5', periodNo: '5', subjectId: 1, subjectName: '수학'},
                                ],
                subjectList: [
                 {subjectId: 1, subjectName: '수학', nationalized: true},
                 {subjectId: 2, subjectName: '영어', nationalized: false},
                 {subjectId: 3, subjectName: '과학', nationalized: false},
                 {subjectId: 4, subjectName: '체육', nationalized: true},
                 {subjectId: 5, subjectName: '음악', nationalized: false}
                ], 
       
                makeSchedule: function(dayOfWeek, periodNo, subjectId, subjectName){
                    return {dayOfWeek, periodNo, subjectId, subjectName}; 
                },
                makeKey: function(v1, v2){
                    return v1 + '_' + v2;
                },
                displaySubject: function(key){  
                    let subjectName = this.userSchedule[key].subjectName; 
                    return subjectName ? subjectName : "선택";
                },
                selectSubject: function(subject){
                    this.currentSelectedSubject = subject;
                },     
                setSubject: function(key){
                    if(!this.currentSelectedSubject) return; 
                    let current = this.currentSelectedSubject;  
                    let value = this.userSchedule[key]; 
                    Object.assign(value, {subjectName: current.subjectName, 
                                                    subjectId: current.subjectId});    
                    
                },    
                clearAll: function(){
                    let _this = this; 
                    _this.userSchedule = 
                    [].reduce((map, s) => {
                            let key = _this.makeKey(s.dayOfWeek, s.periodNo);
                            map[key] = s;
                            return map;
                        },{});
                    _this.periodList.forEach((p) => {   
                        _this.dayOfWeekList.forEach((d) => {
                            let key = _this.makeKey(d.value, p.value);   
                            if(!(key in _this.userSchedule)) { 
                                _this.userSchedule[key] = _this.makeSchedule(d.value, p.value);
                            } 
                        }); 
                    });
                },
                initFunc: function(){  
                    let _this = this; 
                    _this.userSchedule = 
                    _this.userScheduleList.reduce((map, s) => {
                            let key = _this.makeKey(s.dayOfWeek, s.periodNo);
                            map[key] = s;
                            return map;
                        },{});
                    _this.periodList.forEach((p) => {  
                        let pKey = _this.makeKey('p', p.value);
                        _this.keyList[pKey] = [];
                        _this.dayOfWeekList.forEach((d) => {
                            let key = _this.makeKey(d.value, p.value);  
                            _this.keyList[pKey].push(key);
                            if(!(key in _this.userSchedule)) { 
                                _this.userSchedule[key] = _this.makeSchedule(d.value, p.value);
                            } 
                        }); 
                    });
                }
            }
        }
    </script>
</head>
<body>
    <div x-data="getData()" x-init="initFunc"> 
        <div>
            <ul>
                <template x-for="subject in subjectList">
                    <li x-text="subject.subjectName" @click="selectSubject(subject)"></li>
                </template> 
            </ul>
        </div>
        <table>
            <thead>
                <tr>
                    <th></th>
                    <template x-for="dayOfWeek in dayOfWeekList">
                        <th x-text="dayOfWeek.text"></th>
                    </template> 
                </tr>
            </thead>
            <tbody>
                <template x-for="periodNo in periodList">
                    <tr>
                        <td x-text="periodNo.text"></td>
                        <template x-for="key in keyList[makeKey('p' , periodNo.value)]" :key="key"> 
                            <td x-text="displaySubject(key)" @click="setSubject(key)"></td>
                        </template>
                    </tr>
                </template>  
            </tbody>
        </table>

        <button @click="clearAll">ttt</button>
    </div>
</body>
</!DICThtml>